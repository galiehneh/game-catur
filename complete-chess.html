<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Chess Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .board-container {
            display: flex;
            gap: 20px;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 4px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            user-select: none;
        }
        
        .white {
            background-color: #f0d9b5;
        }
        
        .black {
            background-color: #b58863;
        }
        
        .highlight {
            background-color: #aec6cf !important;
        }
        
        .last-move {
            background-color: #90ee90 !important;
        }
        
        .possible-move::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .status {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .coordinates {
            position: absolute;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.3);
        }
        
        .file-coords {
            display: flex;
            justify-content: space-between;
            width: 480px;
            padding: 0 4px;
            margin-top: 2px;
        }
        
        .rank-coords {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 480px;
            margin-right: 4px;
        }
        
        .rank-coord {
            height: 60px;
            display: flex;
            align-items: flex-start;
            padding-top: 2px;
            padding-left: 2px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Complete Chess Game</h1>
        <div class="status" id="status">White's turn</div>
        
        <div class="board-container">
            <div class="rank-coords" id="rankCoords"></div>
            <div>
                <div class="board" id="chessboard"></div>
                <div class="file-coords" id="fileCoords"></div>
            </div>
        </div>
        
        <div class="controls">
            <button id="newGame">New Game</button>
            <button id="undoMove">Undo Move</button>
            <div>Current Player: <span id="currentPlayer">White</span></div>
        </div>
    </div>

    <script>
        // Representasi papan catur
        let board = [];
        let currentPlayer = 'white';
        let selectedPiece = null;
        let possibleMoves = [];
        let moveHistory = [];
        let lastMove = null;
        
        // Karakter Unicode untuk bidak catur
        const pieces = {
            'white': {
                'king': '♔',
                'queen': '♕',
                'rook': '♖',
                'bishop': '♗',
                'knight': '♘',
                'pawn': '♙'
            },
            'black': {
                'king': '♚',
                'queen': '♛',
                'rook': '♜',
                'bishop': '♝',
                'knight': '♞',
                'pawn': '♟'
            }
        };
        
        // Setup awal papan catur
        function initializeBoard() {
            board = Array(8).fill().map(() => Array(8).fill(null));
            
            // Setup bidak hitam
            board[0][0] = {type: 'rook', color: 'black'};
            board[0][1] = {type: 'knight', color: 'black'};
            board[0][2] = {type: 'bishop', color: 'black'};
            board[0][3] = {type: 'queen', color: 'black'};
            board[0][4] = {type: 'king', color: 'black'};
            board[0][5] = {type: 'bishop', color: 'black'};
            board[0][6] = {type: 'knight', color: 'black'};
            board[0][7] = {type: 'rook', color: 'black'};
            
            for (let i = 0; i < 8; i++) {
                board[1][i] = {type: 'pawn', color: 'black'};
            }
            
            // Setup bidak putih
            for (let i = 0; i < 8; i++) {
                board[6][i] = {type: 'pawn', color: 'white'};
            }
            
            board[7][0] = {type: 'rook', color: 'white'};
            board[7][1] = {type: 'knight', color: 'white'};
            board[7][2] = {type: 'bishop', color: 'white'};
            board[7][3] = {type: 'queen', color: 'white'};
            board[7][4] = {type: 'king', color: 'white'};
            board[7][5] = {type: 'bishop', color: 'white'};
            board[7][6] = {type: 'knight', color: 'white'};
            board[7][7] = {type: 'rook', color: 'white'};
        }
        
        // Render koordinat
        function renderCoordinates() {
            // File coordinates (a-h)
            const fileCoords = document.getElementById('fileCoords');
            fileCoords.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const coord = document.createElement('div');
                coord.textContent = String.fromCharCode(97 + i); // a-h
                fileCoords.appendChild(coord);
            }
            
            // Rank coordinates (1-8)
            const rankCoords = document.getElementById('rankCoords');
            rankCoords.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const coord = document.createElement('div');
                coord.className = 'rank-coord';
                coord.textContent = 8 - i; // 8-1
                rankCoords.appendChild(coord);
            }
        }
        
        // Render papan catur
        function renderBoard() {
            const chessboard = document.getElementById('chessboard');
            chessboard.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = (row + col) % 2 === 0 ? 'white square' : 'black square';
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    // Tandai langkah terakhir
                    if (lastMove && 
                        ((lastMove.fromRow === row && lastMove.fromCol === col) || 
                         (lastMove.toRow === row && lastMove.toCol === col))) {
                        square.classList.add('last-move');
                    }
                    
                    const piece = board[row][col];
                    if (piece) {
                        square.textContent = pieces[piece.color][piece.type];
                    }
                    
                    square.addEventListener('click', () => handleSquareClick(row, col));
                    chessboard.appendChild(square);
                }
            }
            
            document.getElementById('currentPlayer').textContent = currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1);
            document.getElementById('status').textContent = currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1) + "'s turn";
        }
        
        // Dapatkan langkah yang mungkin untuk bidak
        function getPossibleMoves(row, col) {
            const piece = board[row][col];
            if (!piece) return [];
            
            const moves = [];
            
            switch (piece.type) {
                case 'pawn':
                    getPawnMoves(row, col, piece.color, moves);
                    break;
                case 'rook':
                    getRookMoves(row, col, piece.color, moves);
                    break;
                case 'knight':
                    getKnightMoves(row, col, piece.color, moves);
                    break;
                case 'bishop':
                    getBishopMoves(row, col, piece.color, moves);
                    break;
                case 'queen':
                    getRookMoves(row, col, piece.color, moves);
                    getBishopMoves(row, col, piece.color, moves);
                    break;
                case 'king':
                    getKingMoves(row, col, piece.color, moves);
                    break;
            }
            
            return moves;
        }
        
        // Langkah pion
        function getPawnMoves(row, col, color, moves) {
            const direction = color === 'white' ? -1 : 1;
            const startRow = color === 'white' ? 6 : 1;
            
            // Bergerak satu kotak ke depan
            if (isValidPosition(row + direction, col) && !board[row + direction][col]) {
                moves.push({row: row + direction, col: col});
                
                // Bergerak dua kotak jika di posisi awal
                if (row === startRow && !board[row + 2 * direction][col]) {
                    moves.push({row: row + 2 * direction, col: col});
                }
            }
            
            // Menangkap diagonal
            for (let offset of [-1, 1]) {
                if (isValidPosition(row + direction, col + offset) && 
                    board[row + direction][col + offset] && 
                    board[row + direction][col + offset].color !== color) {
                    moves.push({row: row + direction, col: col + offset});
                }
            }
        }
        
        // Langkah benteng
        function getRookMoves(row, col, color, moves) {
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
            
            for (let [dr, dc] of directions) {
                let r = row + dr;
                let c = col + dc;
                
                while (isValidPosition(r, c)) {
                    if (!board[r][c]) {
                        moves.push({row: r, col: c});
                    } else {
                        if (board[r][c].color !== color) {
                            moves.push({row: r, col: c});
                        }
                        break;
                    }
                    r += dr;
                    c += dc;
                }
            }
        }
        
        // Langkah kuda
        function getKnightMoves(row, col, color, moves) {
            const offsets = [
                [-2, -1], [-2, 1], [-1, -2], [-1, 2],
                [1, -2], [1, 2], [2, -1], [2, 1]
            ];
            
            for (let [dr, dc] of offsets) {
                const r = row + dr;
                const c = col + dc;
                
                if (isValidPosition(r, c) && 
                    (!board[r][c] || board[r][c].color !== color)) {
                    moves.push({row: r, col: c});
                }
            }
        }
        
        // Langkah gajah
        function getBishopMoves(row, col, color, moves) {
            const directions = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
            
            for (let [dr, dc] of directions) {
                let r = row + dr;
                let c = col + dc;
                
                while (isValidPosition(r, c)) {
                    if (!board[r][c]) {
                        moves.push({row: r, col: c});
                    } else {
                        if (board[r][c].color !== color) {
                            moves.push({row: r, col: c});
                        }
                        break;
                    }
                    r += dr;
                    c += dc;
                }
            }
        }
        
        // Langkah raja
        function getKingMoves(row, col, color, moves) {
            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];
            
            for (let [dr, dc] of directions) {
                const r = row + dr;
                const c = col + dc;
                
                if (isValidPosition(r, c) && 
                    (!board[r][c] || board[r][c].color !== color)) {
                    moves.push({row: r, col: c});
                }
            }
        }
        
        // Periksa apakah posisi valid
        function isValidPosition(row, col) {
            return row >= 0 && row < 8 && col >= 0 && col < 8;
        }
        
        // Handle klik pada kotak
        function handleSquareClick(row, col) {
            // Jika sudah ada pemenang, tidak bisa bergerak
            if (isCheckmate() || isStalemate()) {
                return;
            }
            
            const piece = board[row][col];
            
            // Jika sudah memilih bidak dan mengklik kotak tujuan
            if (selectedPiece && possibleMoves.some(move => move.row === row && move.col === col)) {
                // Simpan state sebelumnya untuk undo
                moveHistory.push({
                    board: JSON.parse(JSON.stringify(board)),
                    currentPlayer: currentPlayer,
                    lastMove: lastMove
                });
                
                // Pindahkan bidak
                board[row][col] = selectedPiece.piece;
                board[selectedPiece.row][selectedPiece.col] = null;
                
                // Simpan langkah terakhir
                lastMove = {
                    fromRow: selectedPiece.row,
                    fromCol: selectedPiece.col,
                    toRow: row,
                    toCol: col
                };
                
                // Reset seleksi
                selectedPiece = null;
                possibleMoves = [];
                clearHighlights();
                
                // Ganti giliran
                currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
                
                // Update tampilan
                renderBoard();
                updateStatus();
                
                return;
            }
            
            // Jika mengklik bidak sendiri
            if (piece && piece.color === currentPlayer) {
                selectedPiece = { piece, row, col };
                possibleMoves = getPossibleMoves(row, col);
                renderBoard();
                highlightSquare(row, col);
                highlightPossibleMoves(possibleMoves);
                return;
            }
            
            // Reset seleksi jika mengklik kotak kosong atau bidak lawan
            selectedPiece = null;
            possibleMoves = [];
            clearHighlights();
            renderBoard();
        }
        
        // Highlight kotak yang dipilih
        function highlightSquare(row, col) {
            const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            if (square) {
                square.classList.add('highlight');
            }
        }
        
        // Highlight langkah yang mungkin
        function highlightPossibleMoves(moves) {
            moves.forEach(move => {
                const square = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                if (square) {
                    square.classList.add('highlight');
                }
            });
        }
        
        // Clear semua highlight
        function clearHighlights() {
            document.querySelectorAll('.square').forEach(square => {
                square.classList.remove('highlight');
            });
        }
        
        // Update status game
        function updateStatus() {
            const statusElement = document.getElementById('status');
            
            if (isCheckmate()) {
                const winner = currentPlayer === 'white' ? 'Black' : 'White';
                statusElement.textContent = `Checkmate! ${winner} wins!`;
            } else if (isStalemate()) {
                statusElement.textContent = 'Stalemate! Game drawn.';
            } else {
                statusElement.textContent = `${currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1)}'s turn`;
            }
        }
        
        // Periksa checkmate
        function isCheckmate() {
            // Implementasi sederhana - dalam versi lengkap akan memeriksa apakah raja dalam bahaya
            // dan tidak ada langkah yang bisa menyelamatkan
            return false;
        }
        
        // Periksa stalemate
        function isStalemate() {
            // Implementasi sederhana - dalam versi lengkap akan memeriksa apakah tidak ada langkah yang valid
            return false;
        }
        
        // Undo langkah terakhir
        function undoMove() {
            if (moveHistory.length > 0) {
                const prevState = moveHistory.pop();
                board = prevState.board;
                currentPlayer = prevState.currentPlayer;
                lastMove = prevState.lastMove;
                selectedPiece = null;
                possibleMoves = [];
                clearHighlights();
                renderBoard();
                updateStatus();
            }
        }
        
        // Mulai game baru
        function newGame() {
            initializeBoard();
            currentPlayer = 'white';
            selectedPiece = null;
            possibleMoves = [];
            moveHistory = [];
            lastMove = null;
            clearHighlights();
            renderBoard();
            updateStatus();
        }
        
        // Inisialisasi game
        document.addEventListener('DOMContentLoaded', () => {
            renderCoordinates();
            initializeBoard();
            renderBoard();
            updateStatus();
            
            document.getElementById('newGame').addEventListener('click', newGame);
            document.getElementById('undoMove').addEventListener('click', undoMove);
        });
    </script>
</body>
</html>